<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Ansible 命令及其使用指南 | 羽痕爱编程</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Ansible 是一个强大的自动化工具，用于配置管理、应用部署和任务自动化。以下是一些常见的 Ansible 命令及其使用指南，帮助你更好地管理和自动化你的基础设施。 1. 安装 Ansible在大多数 Linux 发行版中，你可以使用包管理器来安装 Ansible。例如，在 Ubuntu 上： sudo apt updatesudo apt install ansible 在 CentOS 上：">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansible 命令及其使用指南">
<meta property="og:url" content="http://yuhenabc.com/2024/05/16/ansible/index.html">
<meta property="og:site_name" content="羽痕爱编程">
<meta property="og:description" content="Ansible 是一个强大的自动化工具，用于配置管理、应用部署和任务自动化。以下是一些常见的 Ansible 命令及其使用指南，帮助你更好地管理和自动化你的基础设施。 1. 安装 Ansible在大多数 Linux 发行版中，你可以使用包管理器来安装 Ansible。例如，在 Ubuntu 上： sudo apt updatesudo apt install ansible 在 CentOS 上：">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-16T02:55:17.000Z">
<meta property="article:modified_time" content="2024-10-20T07:37:51.347Z">
<meta property="article:author" content="yuhenabc">
<meta property="article:tag" content="tools">
<meta name="twitter:card" content="summary">
  
  

  
<link rel="stylesheet" href="/css/style.css">

  
  
  


  

  
<!--    <link href='//fonts.useso.com/css?family=Titillium+Web:300,400,600' rel='stylesheet' type='text/css'>-->
<!--    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">-->
  
  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="wrap">
    <header id="header">
  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <a href="/" class="logo"></a>
          </h1>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
            </ul>
            <nav id="sub-nav">
              <div id="search-form-wrap">
                
                  <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><input type="hidden" name="sitesearch" value="http://yuhenabc.com"></form>
                
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="container">
      <div class="main-body container-inner">
        <div class="main-body-inner">
          <section id="main">
            <div class="main-body-header">

              <h1 class="header"><a class="page-title-link" href="/categories/%E7%9F%A5%E8%AF%86%E5%A4%87%E5%BF%98/">知识备忘</a></h1>
            </div>
            <div class="main-body-content">
              
  <article id="post-ansible" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
      <!--  -->
      
        <header class="article-header">
          
  
    <h1 class="article-title" itemprop="name">
      Ansible 命令及其使用指南
    </h1>
  

        </header>
      
      <p class="article-byline">
        <a href="/2024/05/16/ansible/" class="article-date">
  <time datetime="2024-05-16T02:55:17.000Z" itemprop="datePublished">2024-05-16</time>
</a>
      </p>
      <div class="article-entry" itemprop="articleBody">
        <p>Ansible 是一个强大的自动化工具，用于配置管理、应用部署和任务自动化。以下是一些常见的 Ansible 命令及其使用指南，帮助你更好地管理和自动化你的基础设施。</p>
<h3 id="1-安装-Ansible"><a href="#1-安装-Ansible" class="headerlink" title="1. 安装 Ansible"></a>1. 安装 Ansible</h3><p>在大多数 Linux 发行版中，你可以使用包管理器来安装 Ansible。例如，在 Ubuntu 上：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install ansible</span><br></pre></td></tr></table></figure>
<p>在 CentOS 上：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install ansible</span><br></pre></td></tr></table></figure>
<h3 id="2-检查-Ansible-版本"><a href="#2-检查-Ansible-版本" class="headerlink" title="2. 检查 Ansible 版本"></a>2. 检查 Ansible 版本</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible --version</span><br></pre></td></tr></table></figure>
<h3 id="3-配置-Ansible"><a href="#3-配置-Ansible" class="headerlink" title="3. 配置 Ansible"></a>3. 配置 Ansible</h3><p>Ansible 的配置文件通常位于 <code>/etc/ansible/ansible.cfg</code>。你可以在这里设置各种配置选项，例如库存文件路径、日志级别等。</p>
<h3 id="4-创建和管理库存文件"><a href="#4-创建和管理库存文件" class="headerlink" title="4. 创建和管理库存文件"></a>4. 创建和管理库存文件</h3><p>库存文件（Inventory File）定义了你要管理的主机和组。默认的库存文件路径是 <code>/etc/ansible/hosts</code>，但你也可以使用自定义路径。</p>
<h4 id="示例库存文件"><a href="#示例库存文件" class="headerlink" title="示例库存文件"></a>示例库存文件</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/ansible/hosts</span></span><br><span class="line"><span class="section">[webservers]</span></span><br><span class="line">web1.example.com</span><br><span class="line">web2.example.com</span><br><span class="line"></span><br><span class="line"><span class="section">[databases]</span></span><br><span class="line">db1.example.com</span><br><span class="line">db2.example.com</span><br></pre></td></tr></table></figure>
<h3 id="5-测试连接"><a href="#5-测试连接" class="headerlink" title="5. 测试连接"></a>5. 测试连接</h3><p>使用 <code>ansible</code> 命令测试与主机的连接：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible all -m ping</span><br></pre></td></tr></table></figure>
<p>这会向所有主机发送一个 <code>ping</code> 模块，检查它们是否可以被 Ansible 管理。</p>
<h3 id="6-运行-Ad-Hoc-命令"><a href="#6-运行-Ad-Hoc-命令" class="headerlink" title="6. 运行 Ad-Hoc 命令"></a>6. 运行 Ad-Hoc 命令</h3><p>Ad-Hoc 命令是临时性的命令，用于快速执行任务。</p>
<h4 id="示例：在所有主机上安装-Apache"><a href="#示例：在所有主机上安装-Apache" class="headerlink" title="示例：在所有主机上安装 Apache"></a>示例：在所有主机上安装 Apache</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible all -m yum -a <span class="string">&quot;name=httpd state=present&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="示例：在所有主机上启动-Apache-服务"><a href="#示例：在所有主机上启动-Apache-服务" class="headerlink" title="示例：在所有主机上启动 Apache 服务"></a>示例：在所有主机上启动 Apache 服务</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible all -m service -a <span class="string">&quot;name=httpd state=started&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="7-运行-Playbook"><a href="#7-运行-Playbook" class="headerlink" title="7. 运行 Playbook"></a>7. 运行 Playbook</h3><p>Playbook 是 YAML 文件，定义了一系列的任务和配置。使用 <code>ansible-playbook</code> 命令来运行 Playbook。</p>
<h4 id="示例-Playbook-site-yml"><a href="#示例-Playbook-site-yml" class="headerlink" title="示例 Playbook (site.yml)"></a>示例 Playbook (<code>site.yml</code>)</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">become:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">Apache</span> <span class="string">is</span> <span class="string">installed</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">Apache</span> <span class="string">is</span> <span class="string">started</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<p>become 代表是否提升权限，默认提升到 root 用户。tasks 可以串联地执行多个任务。而 yum 和 service 分别是两个模块的名称。</p>
<h4 id="运行-Playbook"><a href="#运行-Playbook" class="headerlink" title="运行 Playbook"></a>运行 Playbook</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml</span><br></pre></td></tr></table></figure>
<p>由于 Playbook 的方式要比 Ad-Hoc 方式更加直观地展示模块的功能，接下来的例子都会使用 Playbook。</p>
<h3 id="8-查看和管理模块"><a href="#8-查看和管理模块" class="headerlink" title="8. 查看和管理模块"></a>8. 查看和管理模块</h3><p>Ansible 提供了大量的模块，用于执行各种任务。你可以使用以下命令查看可用模块：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-doc -l</span><br></pre></td></tr></table></figure>
<p>查看特定模块的详细信息：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-doc yum</span><br></pre></td></tr></table></figure>
<h3 id="9-使用-Vault-加密敏感信息"><a href="#9-使用-Vault-加密敏感信息" class="headerlink" title="9. 使用 Vault 加密敏感信息"></a>9. 使用 Vault 加密敏感信息</h3><p>Ansible Vault 用于加密敏感信息，如密码和密钥。</p>
<h4 id="创建加密文件"><a href="#创建加密文件" class="headerlink" title="创建加密文件"></a>创建加密文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-vault create secrets.yml</span><br></pre></td></tr></table></figure>
<h4 id="编辑加密文件"><a href="#编辑加密文件" class="headerlink" title="编辑加密文件"></a>编辑加密文件</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-vault edit secrets.yml</span><br></pre></td></tr></table></figure>
<h4 id="运行-Playbook-时解密"><a href="#运行-Playbook-时解密" class="headerlink" title="运行 Playbook 时解密"></a>运行 Playbook 时解密</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml --ask-vault-pass</span><br></pre></td></tr></table></figure>
<h3 id="10-使用动态库存"><a href="#10-使用动态库存" class="headerlink" title="10. 使用动态库存"></a>10. 使用动态库存</h3><p>动态库存脚本可以从外部数据源（如 AWS、OpenStack 等）动态生成库存文件。</p>
<h4 id="示例：使用-AWS-动态库存"><a href="#示例：使用-AWS-动态库存" class="headerlink" title="示例：使用 AWS 动态库存"></a>示例：使用 AWS 动态库存</h4><p>安装 <code>boto</code> 库：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip install boto</span><br></pre></td></tr></table></figure>
<p>创建 <code>aws_ec2.py</code> 和 <code>aws_ec2.ini</code> 文件，然后在 Playbook 中指定动态库存：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml -i aws_ec2.py</span><br></pre></td></tr></table></figure>
<h3 id="11-查看和管理主机状态"><a href="#11-查看和管理主机状态" class="headerlink" title="11. 查看和管理主机状态"></a>11. 查看和管理主机状态</h3><p>使用 <code>setup</code> 模块查看主机的状态和变量：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible all -m setup</span><br></pre></td></tr></table></figure>
<h3 id="12-调试-Playbook"><a href="#12-调试-Playbook" class="headerlink" title="12. 调试 Playbook"></a>12. 调试 Playbook</h3><p>使用 <code>-vvv</code> 选项增加输出的详细程度，帮助调试 Playbook：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml -vvv</span><br></pre></td></tr></table></figure>
<h3 id="13-限制-Playbook-的执行范围"><a href="#13-限制-Playbook-的执行范围" class="headerlink" title="13. 限制 Playbook 的执行范围"></a>13. 限制 Playbook 的执行范围</h3><p>使用 <code>--limit</code> 选项限制 Playbook 的执行范围：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml --<span class="built_in">limit</span> web1.example.com</span><br></pre></td></tr></table></figure>
<h3 id="14-检查-Playbook-的语法"><a href="#14-检查-Playbook-的语法" class="headerlink" title="14. 检查 Playbook 的语法"></a>14. 检查 Playbook 的语法</h3><p>使用 <code>--syntax-check</code> 选项检查 Playbook 的语法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml --syntax-check</span><br></pre></td></tr></table></figure>
<h3 id="15-并行执行任务"><a href="#15-并行执行任务" class="headerlink" title="15. 并行执行任务"></a>15. 并行执行任务</h3><p>使用 <code>--forks</code> 选项指定并行执行任务的数量：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ansible-playbook site.yml --forks 10</span><br></pre></td></tr></table></figure>
<p>Ansible 提供了大量内置模块，用于执行各种任务，从简单的文件操作到复杂的系统配置。以下是一些常用的 Ansible 模块及其功能介绍：</p>
<h3 id="1-文件和目录操作"><a href="#1-文件和目录操作" class="headerlink" title="1. 文件和目录操作"></a>1. 文件和目录操作</h3><h4 id="file"><a href="#file" class="headerlink" title="file"></a><code>file</code></h4><p><strong>用途</strong>：管理文件、目录和符号链接的状态。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">directory</span> <span class="string">exists</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/path/to/directory</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0755&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="copy"><a href="#copy" class="headerlink" title="copy"></a><code>copy</code></h4><p><strong>用途</strong>：复制文件到远程节点。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Copy</span> <span class="string">file</span> <span class="string">to</span> <span class="string">remote</span> <span class="string">host</span></span><br><span class="line">  <span class="attr">copy:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/local/path/to/file</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/remote/path/to/file</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">group</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0644&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="template"><a href="#template" class="headerlink" title="template"></a><code>template</code></h4><p><strong>用途</strong>：将 Jinja2 模板文件渲染并复制到远程节点。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Render</span> <span class="string">template</span> <span class="string">to</span> <span class="string">remote</span> <span class="string">host</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/local/path/to/template.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/remote/path/to/file</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">user</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">group</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0644&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="lineinfile"><a href="#lineinfile" class="headerlink" title="lineinfile"></a><code>lineinfile</code></h4><p><strong>用途</strong>：确保一行存在于文件中或替换现有行。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">line</span> <span class="string">is</span> <span class="string">in</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/hosts</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&#x27;127.0.0.1 ansible_host&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h4 id="blockinfile"><a href="#blockinfile" class="headerlink" title="blockinfile"></a><code>blockinfile</code></h4><p><strong>用途</strong>：确保一个块存在于文件中或替换现有块。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">block</span> <span class="string">is</span> <span class="string">in</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">blockinfile:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/hosts</span></span><br><span class="line">    <span class="attr">block:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      127.0.0.1 ansible_host</span></span><br><span class="line"><span class="string">      127.0.0.2 another_host</span></span><br><span class="line"><span class="string"></span>    <span class="attr">marker:</span> <span class="string">&#x27;# &#123;mark&#125; ANSIBLE MANAGED BLOCK&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-包管理"><a href="#2-包管理" class="headerlink" title="2. 包管理"></a>2. 包管理</h3><h4 id="yum"><a href="#yum" class="headerlink" title="yum"></a><code>yum</code></h4><p><strong>用途</strong>：管理 Red Hat/CentOS 系统中的软件包。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Apache</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h4 id="apt"><a href="#apt" class="headerlink" title="apt"></a><code>apt</code></h4><p><strong>用途</strong>：管理 Debian/Ubuntu 系统中的软件包。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Apache</span></span><br><span class="line">  <span class="attr">apt:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">apache2</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h4 id="pip"><a href="#pip" class="headerlink" title="pip"></a><code>pip</code></h4><p><strong>用途</strong>：管理 Python 包。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Flask</span></span><br><span class="line">  <span class="attr">pip:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Flask</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h3 id="3-服务管理"><a href="#3-服务管理" class="headerlink" title="3. 服务管理"></a>3. 服务管理</h3><h4 id="service"><a href="#service" class="headerlink" title="service"></a><code>service</code></h4><p><strong>用途</strong>：管理服务的状态（启动、停止、重启等）。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">Apache</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h4 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a><code>systemd</code></h4><p><strong>用途</strong>：管理 systemd 服务单元。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Enable</span> <span class="string">and</span> <span class="string">start</span> <span class="string">Apache</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">systemd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h3 id="4-用户和组管理"><a href="#4-用户和组管理" class="headerlink" title="4. 用户和组管理"></a>4. 用户和组管理</h3><h4 id="user"><a href="#user" class="headerlink" title="user"></a><code>user</code></h4><p><strong>用途</strong>：管理用户账户。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ansible_user</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="attr">groups:</span> <span class="string">sudo</span></span><br><span class="line">    <span class="attr">shell:</span> <span class="string">/bin/bash</span></span><br></pre></td></tr></table></figure>
<h4 id="group"><a href="#group" class="headerlink" title="group"></a><code>group</code></h4><p><strong>用途</strong>：管理用户组。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">group</span></span><br><span class="line">  <span class="attr">group:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ansible_group</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h3 id="5-系统配置"><a href="#5-系统配置" class="headerlink" title="5. 系统配置"></a>5. 系统配置</h3><h4 id="sysctl"><a href="#sysctl" class="headerlink" title="sysctl"></a><code>sysctl</code></h4><p><strong>用途</strong>：管理内核参数。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">kernel</span> <span class="string">parameter</span></span><br><span class="line">  <span class="attr">sysctl:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">net.ipv4.ip_forward</span></span><br><span class="line">    <span class="attr">value:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="attr">reload:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h4 id="cron"><a href="#cron" class="headerlink" title="cron"></a><code>cron</code></h4><p><strong>用途</strong>：管理定时任务。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Add</span> <span class="string">cron</span> <span class="string">job</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&#x27;Run backup script&#x27;</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="attr">hour:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&#x27;/usr/local/bin/backup.sh&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-网络配置"><a href="#6-网络配置" class="headerlink" title="6. 网络配置"></a>6. 网络配置</h3><h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a><code>netstat</code></h4><p><strong>用途</strong>：获取网络连接信息。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">network</span> <span class="string">connections</span></span><br><span class="line">  <span class="attr">netstat:</span></span><br><span class="line">    <span class="attr">gather_subset:</span> <span class="string">all</span></span><br></pre></td></tr></table></figure>
<h4 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a><code>iptables</code></h4><p><strong>用途</strong>：管理 iptables 规则。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Allow</span> <span class="string">port</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">iptables:</span></span><br><span class="line">    <span class="attr">chain:</span> <span class="string">INPUT</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">    <span class="attr">destination_port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">jump:</span> <span class="string">ACCEPT</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h3 id="7-数据库管理"><a href="#7-数据库管理" class="headerlink" title="7. 数据库管理"></a>7. 数据库管理</h3><h4 id="mysql-user"><a href="#mysql-user" class="headerlink" title="mysql_user"></a><code>mysql_user</code></h4><p><strong>用途</strong>：管理 MySQL 用户。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">MySQL</span> <span class="string">user</span></span><br><span class="line">  <span class="attr">mysql_user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ansible_user</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">secure_password</span></span><br><span class="line">    <span class="attr">priv:</span> <span class="string">&#x27;*.*:ALL&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h4 id="postgresql-db"><a href="#postgresql-db" class="headerlink" title="postgresql_db"></a><code>postgresql_db</code></h4><p><strong>用途</strong>：管理 PostgreSQL 数据库。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">PostgreSQL</span> <span class="string">database</span></span><br><span class="line">  <span class="attr">postgresql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ansible_db</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h3 id="8-云服务管理"><a href="#8-云服务管理" class="headerlink" title="8. 云服务管理"></a>8. 云服务管理</h3><h4 id="ec2"><a href="#ec2" class="headerlink" title="ec2"></a><code>ec2</code></h4><p><strong>用途</strong>：管理 Amazon EC2 实例。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Launch</span> <span class="string">EC2</span> <span class="string">instance</span></span><br><span class="line">  <span class="attr">ec2:</span></span><br><span class="line">    <span class="attr">key_name:</span> <span class="string">my_key</span></span><br><span class="line">    <span class="attr">instance_type:</span> <span class="string">t2.micro</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ami-123456</span></span><br><span class="line">    <span class="attr">wait:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">region:</span> <span class="string">us-west-1</span></span><br><span class="line">    <span class="attr">vpc_subnet_id:</span> <span class="string">subnet-123456</span></span><br><span class="line">    <span class="attr">security_group:</span> <span class="string">my_security_group</span></span><br><span class="line">    <span class="attr">count:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="azure-rm-virtualmachine"><a href="#azure-rm-virtualmachine" class="headerlink" title="azure_rm_virtualmachine"></a><code>azure_rm_virtualmachine</code></h4><p><strong>用途</strong>：管理 Azure 虚拟机。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Azure</span> <span class="string">VM</span></span><br><span class="line">  <span class="attr">azure_rm_virtualmachine:</span></span><br><span class="line">    <span class="attr">resource_group:</span> <span class="string">myResourceGroup</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">myVM</span></span><br><span class="line">    <span class="attr">vm_size:</span> <span class="string">Standard_DS1_v2</span></span><br><span class="line">    <span class="attr">admin_username:</span> <span class="string">azureuser</span></span><br><span class="line">    <span class="attr">ssh_password_enabled:</span> <span class="literal">no</span></span><br><span class="line">    <span class="attr">ssh_public_keys:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/home/azureuser/.ssh/authorized_keys</span></span><br><span class="line">        <span class="attr">key_data:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; lookup(&#x27;file&#x27;, &#x27;~/.ssh/id_rsa.pub&#x27;) &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-其他常用模块"><a href="#9-其他常用模块" class="headerlink" title="9. 其他常用模块"></a>9. 其他常用模块</h3><h4 id="shell-和-command"><a href="#shell-和-command" class="headerlink" title="shell 和 command"></a><code>shell</code> 和 <code>command</code></h4><p><strong>用途</strong>：执行 shell 命令。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">a</span> <span class="string">shell</span> <span class="string">command</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">echo</span> <span class="string">&quot;Hello, World!&quot;</span> <span class="string">&gt;</span> <span class="string">/tmp/hello.txt</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">a</span> <span class="string">command</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">ls</span> <span class="string">-l</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>
<h4 id="debug"><a href="#debug" class="headerlink" title="debug"></a><code>debug</code></h4><p><strong>用途</strong>：打印调试信息。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Debug</span> <span class="string">message</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">msg:</span> <span class="string">&#x27;This is a debug message&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="setup"><a href="#setup" class="headerlink" title="setup"></a><code>setup</code></h4><p><strong>用途</strong>：收集远程主机的事实（facts）。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Gather</span> <span class="string">facts</span></span><br><span class="line">  <span class="attr">setup:</span></span><br></pre></td></tr></table></figure>

      </div>
      <footer class="article-footer">
        <a data-url="http://yuhenabc.com/2024/05/16/ansible/" data-id="cm2h9zix3000ndjnc16186d6t" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
        
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tools/" rel="tag">tools</a></li></ul>

      </footer>
    </div>
  </article>
  
  

            </div>
          </section>
          <aside id="sidebar">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
  <div class="sidebar-top">
    <p>关注我 :</p>
    <ul class="social-links">
      
    </ul>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/06/18/auth-server/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <p class="article-nav-title">
        
          实现一个最简单的单点登录（SSO）系统
        
      </p>
      <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
  
  
    <a href="/2024/04/30/typescript-type-interface/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <p class="article-nav-title">Typescript 中 Type 和 Interface 的区别</p>
      <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
    </a>
  
</nav>

  
  <div class="widgets-container">
    
  </div>
</aside>
        </div>
      </div>
    </div>
    <footer id="footer">
  
  <div class="container">
    <div class="container-inner">
      <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
      <div class="credit">
        <h1 class="logo-wrap">
          <a href="/" class="logo"></a>
        </h1>
        <p>&copy; 2024 yuhenabc</p>
        <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
      </div>
    </div>
  </div>
</footer>
    


<script src="/js/jquery.min.js"></script>









<script src="/js/html-patch.js"></script>


<script src="/js/script.js"></script>


  </div>
</body>
</html>
